function loggedIn(){$("#login").hide();var e=new Dropbox.Datastore.DatastoreManager(client);e.openDefaultDatastore(function(e,t){function n(){return i.getOrInsert("current_level",{level:0})}function o(){setLevel(n().get("level"))}if(e)return void alert("Error: "+e);var i=t.getTable("state");i.setResolutionRule("level","max"),o(),t.recordsChanged.addListener(o),$("#box").click(function(e){e.preventDefault();var t=n();t.set("level",t.get("level")+1)}),$("#reset").click(function(e){e.preventDefault(),n().set("level",0)}),$("#logout").show().click(function(e){e.preventDefault(),client.signOut(),$("#login").show()})})}0===window.location.href.indexOf("http://")&&0!==window.location.host.indexOf("127.0.0.1")&&(window.location=window.location.href.replace("http://","https://"));var client=new Dropbox.Client({key:APP_KEY});client.authDriver(new Dropbox.AuthDriver.Popup({receiverUrl:window.location.href+"oauth_receiver.html"})),client.authenticate({interactive:!1}),client.isAuthenticated()?loggedIn():$("#login").show(),$("#login").click(function(){client.authenticate(function(e){return e?void alert("Error: "+e):void loggedIn()})});